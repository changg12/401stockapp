<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Customer Profile</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css">
    <style>
      .profile-header {
        background: linear-gradient(135deg, #6c757d, #495057);
        color: white;
        padding: 2rem 0;
        margin-bottom: 2rem;
      }
      .card {
        margin-bottom: 2rem;
      }
    </style>
  </head>
  <body class="bg-light">
    <div class="profile-header">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1 class="h2 mb-1">My Profile</h1>
            <p class="lead mb-0">View and update your account information</p>
          </div>
          <div class="col-md-4 text-right">
            {% if session.user_name %}
            <p class="mb-0">Welcome, <strong>{{ session.user_name }}</strong></p>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="row">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-primary text-white">Account Information</div>
            <div class="card-body">
              <form method="post" action="{{ url_for('update_profile') }}">
                <div class="form-group">
                  <label for="full_name">Full Name</label>
                  <input type="text" class="form-control" id="full_name" name="full_name" value="{{ user.full_name }}" required>
                </div>
                <div class="form-group">
                  <label for="email">Email</label>
                  <input type="email" class="form-control" id="email" name="email" value="{{ user.email }}" required>
                </div>
                <div class="form-group">
                  <label for="password">Password</label>
                  <input type="password" class="form-control" id="password" name="password" placeholder="Leave blank to keep current password">
                </div>
                <button type="submit" class="btn btn-success">Update Profile</button>
              </form>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-info text-white">Saved Payment Information</div>
            <div class="card-body">
              <form method="post" action="{{ url_for('save_payment_info') }}">
                <div class="form-group">
                  <label for="payment_type">Payment Type</label>
                  <select class="form-control" id="payment_type" name="payment_type" required onchange="togglePaymentFields()">
                    <option value="">Select...</option>
                    <option value="credit" {% if payment and payment.payment_type == 'credit' %}selected{% endif %}>Credit Card</option>
                    <option value="debit" {% if payment and payment.payment_type == 'debit' %}selected{% endif %}>Debit Card</option>
                    <option value="bank" {% if payment and payment.payment_type == 'bank' %}selected{% endif %}>Bank Account</option>
                  </select>
                </div>
                <div id="card-fields" style="display:none;">
                  <div class="form-group">
                    <label for="card_name">Name on Card</label>
                    <input type="text" class="form-control" id="card_name" name="card_name" value="{{ payment.card_name if payment else '' }}">
                  </div>
                  <div class="form-group">
                    <label for="card_number">Card Number</label>
                    <input type="text" class="form-control" id="card_number" name="card_number" maxlength="19">
                  </div>
                  <div class="form-group">
                    <label for="card_expiration">Expiration (MM/YYYY)</label>
                    <input type="text" class="form-control" id="card_expiration" name="card_expiration" placeholder="MM/YYYY" value="{{ payment.card_expiration if payment else '' }}">
                  </div>
                </div>
                <div id="bank-fields" style="display:none;">
                  <div class="form-group">
                    <label for="bank_account_number">Checking Account Number</label>
                    <input type="text" class="form-control" id="bank_account_number" name="bank_account_number" value="{{ payment.bank_account_number if payment else '' }}">
                  </div>
                  <div class="form-group">
                    <label for="bank_routing_number">Routing Number</label>
                    <input type="text" class="form-control" id="bank_routing_number" name="bank_routing_number" value="{{ payment.bank_routing_number if payment else '' }}">
                  </div>
                </div>
                <button type="submit" class="btn btn-info">Save Payment Info</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      function togglePaymentFields() {
        var type = document.getElementById('payment_type').value;
        document.getElementById('card-fields').style.display = (type === 'credit' || type === 'debit') ? '' : 'none';
        document.getElementById('bank-fields').style.display = (type === 'bank') ? '' : 'none';
      }
      document.addEventListener('DOMContentLoaded', function() {
        togglePaymentFields();
      });
    </script>
  </body>
</html>
